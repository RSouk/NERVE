<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GHOST - Global Intelligence Search</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        /* ===== CSS VARIABLES ===== */
        :root {
            --bg-primary: #030305;
            --bg-secondary: #0a0a0f;
            --bg-card: rgba(12, 12, 18, 0.85);
            --bg-elevated: rgba(20, 20, 30, 0.9);

            --gold-primary: #D4AF37;
            --gold-light: #F4D58D;
            --gold-dark: #B8860B;
            --gold-gradient: linear-gradient(135deg, #D4AF37 0%, #F4D58D 50%, #B8860B 100%);

            --cyan-primary: #00E5FF;
            --cyan-glow: rgba(0, 229, 255, 0.15);

            --purple-primary: #BB86FC;
            --purple-glow: rgba(187, 134, 252, 0.15);

            --red-primary: #FF5252;
            --red-glow: rgba(255, 82, 82, 0.15);

            --green-primary: #00E676;
            --green-glow: rgba(0, 230, 118, 0.15);

            --orange-primary: #FF9800;

            --text-primary: #FFFFFF;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-muted: rgba(255, 255, 255, 0.45);

            --border-subtle: rgba(212, 175, 55, 0.12);
            --border-accent: rgba(212, 175, 55, 0.3);

            --shadow-gold: 0 4px 24px rgba(212, 175, 55, 0.15);
            --shadow-card: 0 8px 32px rgba(0, 0, 0, 0.4);

            --font-display: 'Outfit', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;

            --radius-sm: 6px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;

            --transition-fast: 0.15s ease;
            --transition-normal: 0.25s ease;
            --transition-smooth: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ===== RESET & BASE ===== */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-display);
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* ===== BACKGROUND EFFECTS ===== */
        .page-bg {
            position: fixed;
            inset: 0;
            z-index: -1;
            background:
                radial-gradient(ellipse 80% 50% at 20% 20%, rgba(212, 175, 55, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse 60% 40% at 80% 80%, rgba(0, 229, 255, 0.05) 0%, transparent 50%),
                radial-gradient(ellipse 40% 60% at 50% 50%, rgba(187, 134, 252, 0.03) 0%, transparent 50%);
        }

        .grid-overlay {
            position: fixed;
            inset: 0;
            z-index: -1;
            background-image:
                linear-gradient(rgba(212, 175, 55, 0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(212, 175, 55, 0.02) 1px, transparent 1px);
            background-size: 60px 60px;
            mask-image: radial-gradient(ellipse 80% 60% at 50% 30%, black, transparent);
        }

        /* ===== HEADER ===== */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 40px;
            background: rgba(3, 3, 5, 0.9);
            border-bottom: 1px solid var(--border-subtle);
            backdrop-filter: blur(20px);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-logo {
            height: 56px;
            filter: drop-shadow(0 0 20px rgba(212, 175, 55, 0.3));
        }

        .header-title h1 {
            font-size: 1.8rem;
            font-weight: 700;
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 2px;
        }

        .header-title p {
            font-size: 0.85rem;
            color: var(--text-muted);
            letter-spacing: 1px;
            margin-top: 2px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            font-family: var(--font-display);
            font-size: 0.875rem;
            font-weight: 500;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-normal);
            text-decoration: none;
            border: none;
        }

        .btn-ghost {
            background: rgba(212, 175, 55, 0.08);
            border: 1px solid var(--border-accent);
            color: var(--gold-primary);
        }

        .btn-ghost:hover {
            background: rgba(212, 175, 55, 0.15);
            border-color: var(--gold-primary);
            transform: translateY(-1px);
        }

        .btn-primary {
            background: var(--gold-gradient);
            color: #000;
            font-weight: 600;
            border: none;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-gold);
        }

        .profile-btn .settings-icon {
            color: #D4AF37;
            font-size: 20px;
            filter: drop-shadow(0 0 4px rgba(212, 175, 55, 0.4));
        }

        .profile-btn:hover .settings-icon {
            filter: drop-shadow(0 0 8px rgba(212, 175, 55, 0.6));
        }

        /* ===== QUICK NAV ===== */
        .quick-nav {
            display: flex;
            justify-content: center;
            gap: 12px;
            padding: 16px 40px;
            background: rgba(0, 0, 0, 0.4);
            border-bottom: 1px solid var(--border-subtle);
        }

        .nav-link {
            padding: 8px 20px;
            background: rgba(212, 175, 55, 0.05);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all var(--transition-normal);
        }

        .nav-link:hover {
            background: rgba(212, 175, 55, 0.12);
            border-color: var(--border-accent);
            color: var(--gold-primary);
        }

        .nav-link.active {
            background: rgba(212, 175, 55, 0.15);
            border-color: var(--gold-primary);
            color: var(--gold-primary);
        }

        /* ===== MAIN CONTAINER ===== */
        .main-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 32px 40px;
        }

        /* ===== SEARCH HERO ===== */
        .search-hero {
            text-align: center;
            padding: 48px 0 40px;
        }

        .search-hero h2 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 12px;
            background: linear-gradient(135deg, #fff 0%, var(--gold-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .search-hero p {
            color: var(--text-muted);
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        /* ===== SEARCH BOX ===== */
        .search-section {
            max-width: 900px;
            margin: 0 auto 48px;
        }

        .search-box {
            position: relative;
        }

        .search-input-wrapper {
            display: flex;
            background: var(--bg-card);
            border: 2px solid var(--border-accent);
            border-radius: var(--radius-lg);
            overflow: hidden;
            transition: all var(--transition-normal);
        }

        .search-input-wrapper:focus-within {
            border-color: var(--gold-primary);
            box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.1), var(--shadow-gold);
        }

        .search-history-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 56px;
            background: rgba(212, 175, 55, 0.1);
            border: none;
            border-right: 1px solid var(--border-subtle);
            color: var(--gold-primary);
            font-size: 1.25rem;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .search-history-btn:hover {
            background: rgba(212, 175, 55, 0.2);
        }

        .search-input {
            flex: 1;
            padding: 18px 24px;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-family: var(--font-display);
            font-size: 1rem;
        }

        .search-input::placeholder {
            color: var(--text-muted);
        }

        .search-input:focus {
            outline: none;
        }

        .search-btn {
            padding: 18px 40px;
            background: var(--gold-gradient);
            border: none;
            color: #000;
            font-family: var(--font-display);
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all var(--transition-normal);
        }

        .search-btn:hover {
            filter: brightness(1.1);
        }

        .search-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ===== SEARCH FILTERS ===== */
        .search-filters {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .filter-chip {
            padding: 8px 16px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 20px;
            color: var(--text-secondary);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .filter-chip:hover {
            background: rgba(212, 175, 55, 0.1);
            border-color: var(--border-accent);
            color: var(--gold-primary);
        }

        .filter-chip.active {
            background: rgba(212, 175, 55, 0.15);
            border-color: var(--gold-primary);
            color: var(--gold-primary);
        }

        /* ===== SEARCH EXAMPLES ===== */
        .search-examples {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .example-chip {
            padding: 6px 14px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: var(--radius-sm);
            color: var(--text-muted);
            font-size: 0.8rem;
            font-family: var(--font-mono);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .example-chip:hover {
            background: rgba(212, 175, 55, 0.1);
            border-color: var(--border-accent);
            color: var(--gold-primary);
        }

        /* ===== QUERY HISTORY DROPDOWN ===== */
        .query-history-dropdown {
            display: none;
            position: absolute;
            top: calc(100% + 8px);
            left: 0;
            right: 0;
            background: var(--bg-elevated);
            border: 1px solid var(--border-accent);
            border-radius: var(--radius-lg);
            padding: 20px;
            z-index: 50;
            max-height: 400px;
            overflow-y: auto;
            box-shadow: var(--shadow-card);
        }

        .query-history-dropdown.show {
            display: block;
            animation: slideDown 0.2s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .history-header h4 {
            color: var(--gold-primary);
            font-weight: 600;
        }

        .history-clear-btn {
            padding: 6px 12px;
            background: rgba(255, 82, 82, 0.1);
            border: 1px solid rgba(255, 82, 82, 0.3);
            border-radius: var(--radius-sm);
            color: var(--red-primary);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .history-clear-btn:hover {
            background: rgba(255, 82, 82, 0.2);
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: var(--radius-md);
            margin-bottom: 8px;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .history-item:hover {
            background: rgba(212, 175, 55, 0.1);
        }

        .history-query {
            font-family: var(--font-mono);
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .history-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-muted);
            font-size: 0.75rem;
        }

        /* ===== CONTENT GRID ===== */
        .content-grid {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 32px;
            margin-top: 32px;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .sidebar-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            padding: 24px;
            backdrop-filter: blur(10px);
        }

        .sidebar-card h3 {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--gold-primary);
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* ===== FILTER SIDEBAR ===== */
        .filter-group {
            margin-bottom: 20px;
        }

        .filter-group:last-child {
            margin-bottom: 0;
        }

        .filter-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            display: block;
        }

        .filter-select {
            width: 100%;
            padding: 10px 14px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-family: var(--font-display);
            font-size: 0.875rem;
            cursor: pointer;
            transition: all var(--transition-fast);
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23D4AF37' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
        }

        .filter-select:hover {
            border-color: var(--border-accent);
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--gold-primary);
        }

        .filter-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .filter-option:hover {
            background: rgba(212, 175, 55, 0.08);
        }

        .filter-option input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: var(--gold-primary);
        }

        .filter-option label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .filter-clear-btn {
            width: 100%;
            padding: 10px;
            background: rgba(255, 82, 82, 0.08);
            border: 1px solid rgba(255, 82, 82, 0.2);
            border-radius: var(--radius-md);
            color: var(--red-primary);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all var(--transition-fast);
            margin-top: 16px;
        }

        .filter-clear-btn:hover {
            background: rgba(255, 82, 82, 0.15);
        }

        /* ===== MONITORING CARD ===== */
        .monitoring-input {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .monitoring-input input {
            flex: 1;
            padding: 10px 14px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .monitoring-input input:focus {
            outline: none;
            border-color: var(--gold-primary);
        }

        .monitoring-input button {
            padding: 10px 16px;
            background: var(--gold-gradient);
            border: none;
            border-radius: var(--radius-md);
            color: #000;
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .monitoring-input button:hover {
            transform: translateY(-1px);
        }

        .monitored-list {
            max-height: 180px;
            overflow-y: auto;
        }

        .monitored-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: var(--radius-sm);
            margin-bottom: 8px;
        }

        .monitored-email {
            font-family: var(--font-mono);
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .monitored-remove {
            background: none;
            border: none;
            color: var(--red-primary);
            cursor: pointer;
            font-size: 1rem;
            opacity: 0.6;
            transition: opacity var(--transition-fast);
        }

        .monitored-remove:hover {
            opacity: 1;
        }

        .monitoring-stats {
            background: rgba(0, 0, 0, 0.2);
            border-radius: var(--radius-md);
            padding: 12px;
            margin-top: 16px;
        }

        .monitoring-stat {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            font-size: 0.8rem;
        }

        .monitoring-stat span:first-child {
            color: var(--text-muted);
        }

        .monitoring-stat span:last-child {
            color: var(--text-primary);
        }

        /* ===== RESULTS AREA ===== */
        .results-area {
            min-height: 400px;
        }

        /* ===== RESULTS HEADER ===== */
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            padding: 20px 24px;
            margin-bottom: 24px;
            backdrop-filter: blur(10px);
        }

        .results-stats {
            display: flex;
            gap: 32px;
        }

        .result-stat {
            text-align: center;
        }

        .result-stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            font-family: var(--font-mono);
            color: var(--gold-primary);
        }

        .result-stat-value.critical { color: var(--red-primary); }
        .result-stat-value.warning { color: var(--orange-primary); }
        .result-stat-value.safe { color: var(--green-primary); }

        .result-stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 4px;
        }

        .results-meta {
            text-align: right;
        }

        .query-type-badge {
            display: inline-block;
            padding: 4px 12px;
            background: rgba(0, 229, 255, 0.1);
            border: 1px solid rgba(0, 229, 255, 0.3);
            border-radius: 20px;
            color: var(--cyan-primary);
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .query-text {
            font-family: var(--font-mono);
            font-size: 0.95rem;
            color: var(--text-primary);
        }

        .export-buttons {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .export-btn {
            padding: 8px 14px;
            background: rgba(212, 175, 55, 0.08);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-sm);
            color: var(--gold-primary);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .export-btn:hover {
            background: rgba(212, 175, 55, 0.15);
            border-color: var(--border-accent);
        }

        /* ===== RESULT CARDS ===== */
        .results-section {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            margin-bottom: 20px;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .results-section.attack-path {
            border-color: rgba(255, 82, 82, 0.3);
            background: linear-gradient(135deg, rgba(255, 82, 82, 0.05) 0%, var(--bg-card) 100%);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 24px;
            border-bottom: 1px solid var(--border-subtle);
            background: rgba(0, 0, 0, 0.2);
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--gold-primary);
        }

        .section-title-icon {
            font-size: 1.1rem;
        }

        .section-count {
            padding: 4px 12px;
            background: rgba(212, 175, 55, 0.15);
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--gold-primary);
            font-family: var(--font-mono);
        }

        .section-content {
            padding: 20px 24px;
        }

        /* ===== RESULT ITEM ===== */
        .result-item {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-left: 3px solid var(--gold-primary);
            border-radius: var(--radius-md);
            padding: 16px 20px;
            margin-bottom: 12px;
            transition: all var(--transition-fast);
        }

        .result-item:hover {
            background: rgba(212, 175, 55, 0.05);
            border-color: var(--border-accent);
            border-left-color: var(--gold-primary);
        }

        .result-item:last-child {
            margin-bottom: 0;
        }

        .result-item.severity-critical {
            border-left-color: var(--red-primary);
        }

        .result-item.severity-high {
            border-left-color: var(--orange-primary);
        }

        .result-item.severity-medium {
            border-left-color: #FFEB3B;
        }

        .result-primary {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .result-value {
            font-family: var(--font-mono);
            font-size: 0.95rem;
            color: var(--text-primary);
            word-break: break-all;
        }

        .result-badges {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
            margin-left: 16px;
        }

        .source-badge {
            padding: 4px 10px;
            background: rgba(212, 175, 55, 0.12);
            border-radius: var(--radius-sm);
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--gold-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .severity-badge {
            padding: 4px 10px;
            border-radius: var(--radius-sm);
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .severity-badge.critical {
            background: rgba(255, 82, 82, 0.15);
            color: var(--red-primary);
        }

        .severity-badge.high {
            background: rgba(255, 152, 0, 0.15);
            color: var(--orange-primary);
        }

        .severity-badge.medium {
            background: rgba(255, 235, 59, 0.15);
            color: #FFEB3B;
        }

        .result-details {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        .result-details span {
            display: inline-block;
            margin-right: 20px;
        }

        .detail-label {
            color: var(--text-muted);
        }

        .result-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .result-actions {
            display: flex;
            gap: 12px;
        }

        .result-action {
            color: var(--gold-primary);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .result-action:hover {
            color: var(--gold-light);
        }

        /* ===== PASSWORD FIELD ===== */
        .password-field {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .password-value {
            font-family: var(--font-mono);
            background: rgba(0, 0, 0, 0.3);
            padding: 4px 10px;
            border-radius: var(--radius-sm);
        }

        .password-toggle {
            padding: 4px 10px;
            background: rgba(212, 175, 55, 0.1);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-sm);
            color: var(--gold-primary);
            font-size: 0.7rem;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .password-toggle:hover {
            background: rgba(212, 175, 55, 0.2);
        }

        /* ===== ATTACK PATH ===== */
        .attack-phase {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 14px 16px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: var(--radius-md);
            margin-bottom: 10px;
        }

        .phase-number {
            width: 28px;
            height: 28px;
            background: var(--gold-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            color: #000;
            flex-shrink: 0;
        }

        .phase-content {
            flex: 1;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .phase-probability {
            padding: 4px 12px;
            background: rgba(255, 82, 82, 0.15);
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--red-primary);
            font-family: var(--font-mono);
        }

        /* ===== EXPAND BUTTON ===== */
        .expand-btn {
            width: 100%;
            padding: 12px;
            background: rgba(212, 175, 55, 0.05);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-md);
            color: var(--gold-primary);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all var(--transition-fast);
            margin-top: 16px;
        }

        .expand-btn:hover {
            background: rgba(212, 175, 55, 0.1);
            border-color: var(--border-accent);
        }

        /* ===== LOADING STATE ===== */
        .loading-state {
            text-align: center;
            padding: 80px 40px;
        }

        .loading-spinner {
            width: 56px;
            height: 56px;
            border: 3px solid rgba(212, 175, 55, 0.15);
            border-top-color: var(--gold-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 24px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-state h3 {
            color: var(--gold-primary);
            font-size: 1.25rem;
            margin-bottom: 8px;
        }

        .loading-state p {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* ===== SKELETON LOADING ===== */
        .skeleton {
            background: linear-gradient(90deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.08) 50%, rgba(255,255,255,0.03) 100%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: var(--radius-md);
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .skeleton-result {
            height: 120px;
            margin-bottom: 12px;
        }

        .skeleton-stat {
            height: 60px;
            width: 100px;
        }

        /* ===== EMPTY STATE ===== */
        .empty-state {
            text-align: center;
            padding: 80px 40px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 24px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        .empty-state p {
            color: var(--text-muted);
            max-width: 400px;
            margin: 0 auto 24px;
            line-height: 1.7;
        }

        .empty-state-tips {
            display: flex;
            justify-content: center;
            gap: 24px;
            flex-wrap: wrap;
        }

        .tip-card {
            padding: 16px 20px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-md);
            text-align: left;
            max-width: 200px;
        }

        .tip-card h4 {
            font-size: 0.85rem;
            color: var(--gold-primary);
            margin-bottom: 6px;
        }

        .tip-card p {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin: 0;
        }

        /* ===== ERROR STATE ===== */
        .error-state {
            text-align: center;
            padding: 60px 40px;
            background: rgba(255, 82, 82, 0.05);
            border: 1px solid rgba(255, 82, 82, 0.2);
            border-radius: var(--radius-lg);
        }

        .error-state-icon {
            font-size: 3rem;
            margin-bottom: 20px;
        }

        .error-state h3 {
            color: var(--red-primary);
            margin-bottom: 8px;
        }

        .error-state p {
            color: var(--text-muted);
        }

        /* ===== UPLOAD MODAL ===== */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            z-index: 200;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border-accent);
            border-radius: var(--radius-xl);
            width: 90%;
            max-width: 560px;
            box-shadow: 0 24px 80px rgba(0, 0, 0, 0.5);
            animation: modalIn 0.3s ease;
        }

        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .modal-header h2 {
            font-size: 1.25rem;
            color: var(--gold-primary);
        }

        .modal-close {
            width: 36px;
            height: 36px;
            background: rgba(255, 255, 255, 0.05);
            border: none;
            border-radius: var(--radius-sm);
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: rgba(255, 82, 82, 0.1);
            color: var(--red-primary);
        }

        .modal-body {
            padding: 24px;
        }

        .beta-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: rgba(255, 152, 0, 0.1);
            border: 1px solid rgba(255, 152, 0, 0.3);
            border-radius: var(--radius-md);
            color: var(--orange-primary);
            font-size: 0.85rem;
            margin-bottom: 20px;
            width: 100%;
        }

        .file-dropzone {
            padding: 48px 24px;
            background: rgba(0, 0, 0, 0.2);
            border: 2px dashed var(--border-accent);
            border-radius: var(--radius-lg);
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-normal);
            margin-bottom: 20px;
        }

        .file-dropzone:hover {
            background: rgba(212, 175, 55, 0.05);
            border-color: var(--gold-primary);
        }

        .file-dropzone.has-file {
            border-color: var(--green-primary);
            background: rgba(0, 230, 118, 0.05);
        }

        .dropzone-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
            opacity: 0.6;
        }

        .dropzone-text {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        .dropzone-hint {
            color: var(--text-muted);
            font-size: 0.8rem;
            margin-top: 8px;
        }

        .upload-progress {
            margin-bottom: 20px;
            display: none;
        }

        .progress-bar-bg {
            height: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-bar-fill {
            height: 100%;
            background: var(--gold-gradient);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            font-family: var(--font-mono);
            font-size: 0.85rem;
            color: var(--gold-primary);
        }

        .upload-success {
            padding: 16px;
            background: rgba(0, 230, 118, 0.1);
            border: 1px solid rgba(0, 230, 118, 0.3);
            border-radius: var(--radius-md);
            text-align: center;
            color: var(--green-primary);
            margin-bottom: 20px;
            display: none;
        }

        .upload-btn {
            width: 100%;
            padding: 14px;
            background: var(--gold-gradient);
            border: none;
            border-radius: var(--radius-md);
            color: #000;
            font-family: var(--font-display);
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all var(--transition-normal);
        }

        .upload-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-gold);
        }

        .upload-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        /* ===== SEARCH MODE TOGGLE ===== */
        .search-mode-toggle {
            display: none;
            justify-content: center;
            gap: 4px;
            margin-top: 16px;
            padding: 4px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: var(--radius-md);
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
        }

        .mode-btn {
            padding: 10px 24px;
            background: transparent;
            border: none;
            border-radius: var(--radius-sm);
            color: var(--text-muted);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .mode-btn:hover {
            color: var(--text-secondary);
        }

        .mode-btn.active {
            background: var(--gold-gradient);
            color: #000;
            font-weight: 600;
        }

        /* ===== SCROLLBAR ===== */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(212, 175, 55, 0.3);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(212, 175, 55, 0.5);
        }

        /* ===== ANIMATIONS ===== */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in-up {
            animation: fadeInUp 0.4s ease forwards;
        }

        .stagger-1 { animation-delay: 0.05s; }
        .stagger-2 { animation-delay: 0.1s; }
        .stagger-3 { animation-delay: 0.15s; }
        .stagger-4 { animation-delay: 0.2s; }
        .stagger-5 { animation-delay: 0.25s; }

        /* ===== SEARCH ACTIONS ===== */
        .search-actions {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 16px;
        }

        .upload-breach-btn {
            padding: 12px 24px;
            background: rgba(212, 175, 55, 0.1);
            border: 1px solid var(--border-accent);
            border-radius: var(--radius-md);
            color: var(--gold-primary);
            font-family: var(--font-display);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-normal);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .upload-breach-btn:hover {
            background: rgba(212, 175, 55, 0.2);
            border-color: var(--gold-primary);
            transform: translateY(-1px);
        }

        /* ===== EMAIL MONITORING SECTION ===== */
        .email-monitoring-section {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            padding: 28px;
            margin-bottom: 24px;
            backdrop-filter: blur(10px);
        }

        .monitoring-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .monitoring-header h2 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--gold-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .monitoring-limit {
            font-size: 0.85rem;
            color: var(--text-secondary);
            background: rgba(212, 175, 55, 0.1);
            padding: 6px 14px;
            border-radius: 20px;
        }

        .monitoring-actions {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .add-email-form {
            flex: 1;
            min-width: 280px;
            display: flex;
            gap: 10px;
        }

        .add-email-form input {
            flex: 1;
            padding: 12px 16px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .add-email-form input:focus {
            outline: none;
            border-color: var(--gold-primary);
        }

        .add-email-form button {
            padding: 12px 20px;
            background: var(--gold-gradient);
            border: none;
            border-radius: var(--radius-md);
            color: #000;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            white-space: nowrap;
        }

        .add-email-form button:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-gold);
        }

        .bulk-upload-btn {
            padding: 12px 20px;
            background: rgba(212, 175, 55, 0.08);
            border: 1px solid var(--border-accent);
            border-radius: var(--radius-md);
            color: var(--gold-primary);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .bulk-upload-btn:hover {
            background: rgba(212, 175, 55, 0.15);
            border-color: var(--gold-primary);
        }

        .monitored-emails-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .monitored-email-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 18px;
            background: rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
        }

        .monitored-email-card:hover {
            background: rgba(212, 175, 55, 0.05);
            border-color: var(--border-accent);
        }

        .monitored-email-card .email-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .monitored-email-card .email-address {
            font-family: var(--font-mono);
            font-size: 0.85rem;
            color: var(--text-primary);
        }

        .monitored-email-card .email-status {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .monitored-email-card .email-status.breached {
            color: var(--red-primary);
        }

        .monitored-email-card .email-status.safe {
            color: var(--green-primary);
        }

        .monitored-email-card .remove-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.25rem;
            cursor: pointer;
            opacity: 0.5;
            transition: all var(--transition-fast);
            padding: 4px 8px;
        }

        .monitored-email-card .remove-btn:hover {
            color: var(--red-primary);
            opacity: 1;
        }

        .monitoring-schedule {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: var(--radius-md);
        }

        .monitoring-schedule h3 {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .monitoring-schedule select {
            padding: 8px 14px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-size: 0.85rem;
        }

        .empty-monitoring {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
        }

        .empty-monitoring-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        /* ===== MONITORING RESULTS SECTION ===== */
        .monitoring-results-section {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            padding: 28px;
            margin-bottom: 24px;
            backdrop-filter: blur(10px);
        }

        .results-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .results-section-header h3 {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--gold-primary);
        }

        .results-section-header button {
            padding: 8px 16px;
            background: rgba(212, 175, 55, 0.1);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-sm);
            color: var(--gold-primary);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .results-section-header button:hover {
            background: rgba(212, 175, 55, 0.2);
        }

        .check-schedule-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
            padding: 16px 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: var(--radius-md);
        }

        .schedule-item {
            font-size: 0.85rem;
        }

        .schedule-item strong {
            color: var(--text-secondary);
            display: block;
            font-size: 0.75rem;
            margin-bottom: 4px;
        }

        .schedule-item span {
            color: var(--gold-primary);
            font-family: var(--font-mono);
        }

        .timeline-section h4 {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .timeline {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .timeline-entry {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 18px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: var(--radius-md);
            border-left: 3px solid var(--gold-primary);
        }

        .timeline-date {
            font-size: 0.8rem;
            color: var(--text-muted);
            min-width: 140px;
        }

        .timeline-results {
            display: flex;
            gap: 20px;
            flex: 1;
            padding: 0 20px;
        }

        .emails-checked {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .breaches-found {
            font-size: 0.85rem;
            color: var(--red-primary);
            font-weight: 500;
        }

        .breaches-found.none {
            color: var(--green-primary);
        }

        .timeline-entry button {
            padding: 6px 14px;
            background: rgba(212, 175, 55, 0.1);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-sm);
            color: var(--gold-primary);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .timeline-entry button:hover {
            background: rgba(212, 175, 55, 0.2);
        }

        /* ===== BULK EMAIL MODAL ===== */
        .bulk-email-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            z-index: 200;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .bulk-email-modal.show {
            display: flex;
        }

        .bulk-modal-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border-accent);
            border-radius: var(--radius-xl);
            width: 90%;
            max-width: 520px;
            box-shadow: 0 24px 80px rgba(0, 0, 0, 0.5);
        }

        .bulk-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .bulk-modal-header h2 {
            font-size: 1.15rem;
            color: var(--gold-primary);
        }

        .bulk-modal-header .close-btn {
            width: 32px;
            height: 32px;
            background: rgba(255, 255, 255, 0.05);
            border: none;
            border-radius: var(--radius-sm);
            color: var(--text-muted);
            font-size: 1.25rem;
            cursor: pointer;
        }

        .bulk-modal-header .close-btn:hover {
            background: rgba(255, 82, 82, 0.1);
            color: var(--red-primary);
        }

        .bulk-modal-body {
            padding: 24px;
        }

        .bulk-modal-body p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 16px;
        }

        .bulk-modal-body textarea {
            width: 100%;
            height: 200px;
            padding: 14px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-family: var(--font-mono);
            font-size: 0.85rem;
            resize: vertical;
            margin-bottom: 16px;
        }

        .bulk-modal-body textarea:focus {
            outline: none;
            border-color: var(--gold-primary);
        }

        .bulk-modal-body button {
            width: 100%;
            padding: 14px;
            background: var(--gold-gradient);
            border: none;
            border-radius: var(--radius-md);
            color: #000;
            font-weight: 700;
            cursor: pointer;
            transition: all var(--transition-normal);
        }

        .bulk-modal-body button:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-gold);
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1024px) {
            .content-grid {
                grid-template-columns: 1fr;
            }

            .sidebar {
                flex-direction: row;
                overflow-x: auto;
            }

            .sidebar-card {
                min-width: 280px;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 16px 20px;
            }

            .main-container {
                padding: 20px;
            }

            .search-hero h2 {
                font-size: 1.75rem;
            }

            .results-header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .results-meta {
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- Background Effects -->
    <div class="page-bg"></div>
    <div class="grid-overlay"></div>

    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <img src="ghost-logo.png" alt="GHOST" class="header-logo">
            <div class="header-title">
                <h1>GHOST</h1>
                <p>Global Intelligence Search</p>
            </div>
        </div>
        <div class="header-actions">
            <a href="../../profile.html" class="btn btn-ghost profile-btn" title="Profile">
                <span class="settings-icon"></span>
            </a>
            <a href="ghost.html" class="btn btn-ghost">
                <span>&#8592;</span> Dashboard
            </a>
        </div>
    </header>

    <!-- Quick Navigation -->
    <nav class="quick-nav">
        <a href="ghost-search.html" class="nav-link active">Global Search</a>
        <a href="ghost-adversary.html" class="nav-link">Adversary Matching</a>
        <a href="ghost-asm.html" class="nav-link">Attack Surface</a>
        <a href="ghost-roadmap.html" class="nav-link">Security Roadmap</a>
    </nav>

    <!-- Main Content -->
    <main class="main-container">
        <!-- Search Hero -->
        <div class="search-hero">
            <h2>Intelligence Search</h2>
            <p>Search across breach databases, dark web sources, and threat intelligence feeds</p>
        </div>

        <!-- Search Section -->
        <div class="search-section">
            <div class="search-box">
                <div class="search-input-wrapper">
                    <button class="search-history-btn" onclick="toggleQueryHistory()" title="Search History">
                        &#128337;
                    </button>
                    <input
                        type="text"
                        id="search-input"
                        class="search-input"
                        placeholder="Search email, domain, password, username, IP, or keyword..."
                        onkeypress="if(event.key === 'Enter') performSearch()"
                        autofocus
                    >
                    <button class="search-btn" onclick="performSearch()">Search</button>
                </div>

                <!-- Query History Dropdown -->
                <div id="query-history-dropdown" class="query-history-dropdown">
                    <div class="history-header">
                        <h4>Search History</h4>
                        <button class="history-clear-btn" onclick="clearQueryHistory()">Clear All</button>
                    </div>
                    <div id="query-history-list"></div>
                </div>
            </div>

            <!-- Search Mode Toggle -->
            <div id="searchModeToggle" class="search-mode-toggle">
                <button id="globalModeBtn" class="mode-btn active" onclick="toggleSearchMode('global')">Global Search</button>
                <button id="uploadedModeBtn" class="mode-btn" onclick="toggleSearchMode('uploaded')">My Uploaded File</button>
            </div>

            <!-- Search Actions -->
            <div class="search-actions">
                <button class="upload-breach-btn" onclick="openUploadModal()">
                     Upload Breach File
                </button>
            </div>

            <!-- Search Examples -->
            <div class="search-examples">
                <span class="example-chip" onclick="exampleSearch('test@example.com')">test@example.com</span>
                <span class="example-chip" onclick="exampleSearch('example.com')">example.com</span>
                <span class="example-chip" onclick="exampleSearch('john_doe')">john_doe</span>
                <span class="example-chip" onclick="exampleSearch('192.168.1.1')">192.168.1.1</span>
                <span class="example-chip" onclick="exampleSearch('Password123!')">Password123!</span>
            </div>
        </div>

        <!-- Content Grid (Filters & Results) -->
        <div class="content-grid">
            <!-- Sidebar -->
            <aside class="sidebar">
                <!-- Filters -->
                <div class="sidebar-card">
                    <h3>Filters</h3>

                    <div class="filter-group">
                        <span class="filter-label">Result Type</span>
                        <select id="filterType" class="filter-select">
                            <option value="all">All Results</option>
                            <option value="credentials">Credentials Only</option>
                            <option value="machines">Infected Machines</option>
                            <option value="breaches">Breach History</option>
                            <option value="attack">Attack Paths</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <span class="filter-label">Data Source</span>
                        <select id="filterSource" class="filter-select">
                            <option value="all">All Sources</option>
                            <option value="Infostealer Logs">Infostealer Logs</option>
                            <option value="Public Breach Database">Breach Databases</option>
                            <option value="Dark Web Channels">Dark Web</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <span class="filter-label">Date Range</span>
                        <select id="filterDate" class="filter-select">
                            <option value="all">All Time</option>
                            <option value="30">Last 30 Days</option>
                            <option value="90">Last 90 Days</option>
                            <option value="365">Last Year</option>
                        </select>
                    </div>

                    <button class="filter-clear-btn" onclick="clearFilters()">Clear All Filters</button>
                </div>
            </aside>

            <!-- Results Area -->
            <div class="results-area">
                <div id="results">
                    <!-- Empty State (Initial) -->
                    <div class="empty-state">
                        <div class="empty-state-icon">&#128269;</div>
                        <h3>Start Your Search</h3>
                        <p>Enter an email, domain, username, IP address, or password to search across our intelligence databases.</p>
                        <div class="empty-state-tips">
                            <div class="tip-card">
                                <h4>Email Search</h4>
                                <p>Find all breaches containing a specific email address</p>
                            </div>
                            <div class="tip-card">
                                <h4>Domain Search</h4>
                                <p>Discover compromised credentials for your organization</p>
                            </div>
                            <div class="tip-card">
                                <h4>Password Check</h4>
                                <p>Check if a password has been exposed in breaches</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Email Monitoring Section -->
        <div class="email-monitoring-section">
            <div class="monitoring-header">
                <h2> Email Monitoring</h2>
                <span class="monitoring-limit">Monitor up to 15 emails for breach exposure</span>
            </div>

            <div class="monitoring-actions">
                <div class="add-email-form">
                    <input type="email" id="emailToMonitor" placeholder="Enter email address">
                    <button onclick="addMonitoredEmail()">+ Add Email</button>
                </div>
                <button class="bulk-upload-btn" onclick="openBulkEmailModal()">
                     Bulk Upload Emails
                </button>
            </div>

            <div id="monitored-emails-grid" class="monitored-emails-grid">
                <div class="empty-monitoring">
                    <div class="empty-monitoring-icon"></div>
                    <p>No emails monitored yet. Add emails above to start monitoring.</p>
                </div>
            </div>

            <div class="monitoring-schedule">
                <h3>Check Frequency:</h3>
                <select id="checkFrequency" onchange="updateCheckFrequency()">
                    <option value="daily">Daily</option>
                    <option value="weekly" selected>Weekly</option>
                    <option value="monthly">Monthly</option>
                </select>
            </div>
        </div>

        <!-- Monitoring Results Section -->
        <div class="monitoring-results-section" id="monitoringResults">
            <div class="results-section-header">
                <h3>Monitoring Results & Timeline</h3>
                <button onclick="exportMonitoringResults()">Export Results</button>
            </div>

            <div class="check-schedule-info">
                <div class="schedule-item">
                    <strong>Check Frequency</strong>
                    <span id="currentFrequency">Weekly</span>
                </div>
                <div class="schedule-item">
                    <strong>Last Check</strong>
                    <span id="lastCheckTime">Never</span>
                </div>
                <div class="schedule-item">
                    <strong>Next Check</strong>
                    <span id="nextCheckTime">--</span>
                </div>
            </div>

            <div class="timeline-section">
                <h4>Check History</h4>
                <div class="timeline" id="checkTimeline">
                    <p style="color: var(--text-muted); text-align: center; padding: 20px;">No check history yet. Add emails and run a check to see results.</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Upload Modal -->
    <div id="uploadModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Upload Breach File</h2>
                <button class="modal-close" onclick="closeUploadModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="beta-badge">
                    <span>&#9888;</span>
                    <span>Files are automatically deleted after 24 hours</span>
                </div>

                <input type="file" id="breachFileInput" accept=".txt,.csv" style="display: none;">
                <div class="file-dropzone" onclick="document.getElementById('breachFileInput').click()">
                    <div class="dropzone-icon">&#128193;</div>
                    <div class="dropzone-text" id="dropzoneText">Click to select file or drag & drop</div>
                    <div class="dropzone-hint">Supports .txt and .csv files up to 2GB</div>
                </div>

                <div id="uploadProgress" class="upload-progress">
                    <div class="progress-bar-bg">
                        <div id="progressBar" class="progress-bar-fill"></div>
                    </div>
                    <div id="progressText" class="progress-text">0%</div>
                </div>

                <div id="uploadSuccess" class="upload-success"></div>

                <button id="uploadFileButton" class="upload-btn" disabled onclick="uploadFile()">
                    Upload File
                </button>
            </div>
        </div>
    </div>

    <!-- Bulk Email Upload Modal -->
    <div id="bulkEmailModal" class="bulk-email-modal">
        <div class="bulk-modal-content">
            <div class="bulk-modal-header">
                <h2>Bulk Upload Emails</h2>
                <button class="close-btn" onclick="closeBulkEmailModal()">&times;</button>
            </div>
            <div class="bulk-modal-body">
                <p>Upload up to 15 emails at once (one per line)</p>
                <textarea id="bulkEmailInput" placeholder="email1@example.com
email2@example.com
email3@example.com"></textarea>
                <button onclick="processBulkEmails()">Add All Emails</button>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:5000';
        let currentResults = null;
        let uploadedFileId = null;
        let currentSearchMode = 'global';

        // Store full results globally for pagination
        let allStealerLogs = [];
        let allCredentials = [];
        let displayedStealerCount = 10;
        let displayedCredentialCount = 10;

        // Store unfiltered results for date filtering
        let unfilteredResults = {
            stealerLogs: [],
            credentials: []
        };

        // Query history
        let queryHistory = JSON.parse(localStorage.getItem('ghost_query_history') || '[]');

        // Check for query parameter from dashboard
        const urlParams = new URLSearchParams(window.location.search);
        const queryParam = urlParams.get('q');
        if (queryParam) {
            document.getElementById('search-input').value = queryParam;
            setTimeout(() => performSearch(), 500);
        }

        // File input change listener
        document.getElementById('breachFileInput').addEventListener('change', (e) => {
            const file = e.target.files[0];
            const uploadBtn = document.getElementById('uploadFileButton');
            const dropzone = document.querySelector('.file-dropzone');
            const dropzoneText = document.getElementById('dropzoneText');

            if (file) {
                const maxSize = 2 * 1024 * 1024 * 1024;
                if (file.size > maxSize) {
                    alert('File is too large. Maximum size is 2GB.');
                    e.target.value = '';
                    return;
                }

                const validTypes = ['.txt', '.csv'];
                const fileExt = '.' + file.name.split('.').pop().toLowerCase();
                if (!validTypes.includes(fileExt)) {
                    alert('Invalid file type. Please upload a .txt or .csv file.');
                    e.target.value = '';
                    return;
                }

                dropzoneText.textContent = file.name;
                dropzone.classList.add('has-file');
                uploadBtn.disabled = false;
            } else {
                dropzoneText.textContent = 'Click to select file or drag & drop';
                dropzone.classList.remove('has-file');
                uploadBtn.disabled = true;
            }
        });

        // Filter event listeners
        document.getElementById('filterType').addEventListener('change', applyFilters);
        document.getElementById('filterSource').addEventListener('change', applyFilters);
        document.getElementById('filterDate').addEventListener('change', applyFilters);

        function exampleSearch(query) {
            document.getElementById('search-input').value = query;
            performSearch();
        }

        function openUploadModal() {
            document.getElementById('uploadModal').classList.add('show');
        }

        function closeUploadModal() {
            document.getElementById('uploadModal').classList.remove('show');
            document.getElementById('uploadProgress').style.display = 'none';
            document.getElementById('uploadSuccess').style.display = 'none';
            document.getElementById('progressBar').style.width = '0%';
            document.getElementById('progressText').textContent = '0%';
        }

        async function uploadFile() {
            const fileInput = document.getElementById('breachFileInput');
            const file = fileInput.files[0];

            if (!file) {
                alert('Please select a file first');
                return;
            }

            const formData = new FormData();
            formData.append('file', file);

            const uploadBtn = document.getElementById('uploadFileButton');
            const progressDiv = document.getElementById('uploadProgress');
            const successDiv = document.getElementById('uploadSuccess');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');

            uploadBtn.disabled = true;
            progressDiv.style.display = 'block';
            successDiv.style.display = 'none';

            try {
                const xhr = new XMLHttpRequest();

                xhr.upload.addEventListener('progress', (e) => {
                    if (e.lengthComputable) {
                        const percentComplete = Math.round((e.loaded / e.total) * 100);
                        progressBar.style.width = percentComplete + '%';
                        progressText.textContent = percentComplete + '%';
                    }
                });

                xhr.addEventListener('load', () => {
                    if (xhr.status === 200) {
                        const response = JSON.parse(xhr.responseText);

                        if (response.success) {
                            uploadedFileId = response.upload_id;
                            successDiv.textContent = `Uploaded! Found ${response.total_credentials} credentials in ${response.total_lines} lines`;
                            successDiv.style.display = 'block';
                            progressDiv.style.display = 'none';

                            document.getElementById('searchModeToggle').style.display = 'flex';

                            setTimeout(() => {
                                closeUploadModal();
                            }, 2000);
                        } else {
                            alert('Upload failed: ' + (response.error || 'Unknown error'));
                            progressDiv.style.display = 'none';
                        }
                    } else {
                        alert('Upload failed. Server returned status: ' + xhr.status);
                        progressDiv.style.display = 'none';
                    }
                    uploadBtn.disabled = false;
                });

                xhr.addEventListener('error', () => {
                    alert('Upload failed. Please check your connection.');
                    progressDiv.style.display = 'none';
                    uploadBtn.disabled = false;
                });

                xhr.open('POST', `${API_URL}/api/ghost/upload-breach-file`);
                xhr.send(formData);

            } catch (error) {
                alert('Upload error: ' + error.message);
                progressDiv.style.display = 'none';
                uploadBtn.disabled = false;
            }
        }

        function toggleSearchMode(mode) {
            currentSearchMode = mode;

            const globalBtn = document.getElementById('globalModeBtn');
            const uploadedBtn = document.getElementById('uploadedModeBtn');

            if (mode === 'global') {
                globalBtn.classList.add('active');
                uploadedBtn.classList.remove('active');
            } else if (mode === 'uploaded') {
                if (!uploadedFileId) {
                    alert('Please upload a file first');
                    return;
                }
                globalBtn.classList.remove('active');
                uploadedBtn.classList.add('active');
            }
        }

        async function performSearch() {
            const input = document.getElementById('search-input');
            const query = input ? input.value.trim() : '';

            if (!query) {
                alert('Please enter a search query');
                return;
            }

            console.log('[SEARCH] Starting search for:', query);

            const resultsDiv = document.getElementById('results');
            if (resultsDiv) {
                resultsDiv.innerHTML = `
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <h3>Searching Intelligence Databases</h3>
                        <p>Querying LeakInsight, HIBP, Hudson Rock, and more...</p>
                    </div>
                `;
            }

            try {
                const response = await fetch('http://localhost:5000/api/search/unified', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        query: query,
                        search_type: 'auto'
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('[SEARCH] Results received:', data);

                saveQueryToHistory(query, data);
                displayResults(data);

            } catch (error) {
                console.error('[SEARCH] Error:', error);
                if (resultsDiv) {
                    resultsDiv.innerHTML = `
                        <div class="error-state">
                            <div class="error-state-icon">&#9888;</div>
                            <h3>Search Failed</h3>
                            <p>${error.message}</p>
                            <p style="font-size: 0.8rem; margin-top: 8px;">Check console (F12) for details</p>
                        </div>
                    `;
                }
            }
        }

        function displayResults(data) {
            const resultsDiv = document.getElementById('results');
            if (!resultsDiv) return;

            currentResults = data;

            // Calculate stats
            const totalFindings = data.total_results || 0;
            const credentialsCount = data.results?.filter(r => r.type === 'credential' || r.email || r.password).length || 0;
            const machinesCount = data.results?.filter(r => r.type === 'infected_machine' || r.machine_id).length || 0;
            const hibpCount = data.hibp_count || 0;

            // Detect query type
            const query = data.query || document.getElementById('search-input').value;
            let queryType = 'KEYWORD';
            if (query.includes('@')) queryType = 'EMAIL';
            else if (/^[0-9.]+$/.test(query)) queryType = 'IP';
            else if (query.includes('.') && !query.includes(' ')) queryType = 'DOMAIN';

            let html = `
                <!-- Results Header -->
                <div class="results-header fade-in-up">
                    <div class="results-stats">
                        <div class="result-stat">
                            <div class="result-stat-value ${totalFindings > 100 ? 'critical' : totalFindings > 10 ? 'warning' : ''}">${totalFindings}</div>
                            <div class="result-stat-label">Total Findings</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value">${credentialsCount}</div>
                            <div class="result-stat-label">Credentials</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value">${machinesCount}</div>
                            <div class="result-stat-label">Machines</div>
                        </div>
                        ${hibpCount > 0 ? `
                        <div class="result-stat">
                            <div class="result-stat-value ${hibpCount > 1000 ? 'critical' : hibpCount > 100 ? 'warning' : 'safe'}">${hibpCount.toLocaleString()}</div>
                            <div class="result-stat-label">HIBP Exposures</div>
                        </div>
                        ` : ''}
                    </div>
                    <div class="results-meta">
                        <div class="query-type-badge">${queryType}</div>
                        <div class="query-text">${escapeHtml(query)}</div>
                        <div class="export-buttons">
                            <button class="export-btn" onclick="exportToJSON()">
                                <span>&#128229;</span> JSON
                            </button>
                            <button class="export-btn" onclick="exportToPDF()">
                                <span>&#128196;</span> PDF
                            </button>
                        </div>
                    </div>
                </div>
            `;

            // Group results by type
            const credentials = data.results?.filter(r => r.type === 'credential' || r.email || r.password) || [];
            const machines = data.results?.filter(r => r.type === 'infected_machine' || r.machine_id) || [];
            const breaches = data.results?.filter(r => r.type === 'breach' || r.breach_name) || [];
            const attackPaths = data.attack_paths || [];

            // Attack Paths Section
            if (attackPaths.length > 0) {
                html += `
                    <div class="results-section attack-path fade-in-up stagger-1">
                        <div class="section-header">
                            <div class="section-title">
                                <span class="section-title-icon">&#9888;</span>
                                Potential Attack Paths
                            </div>
                            <span class="section-count">${attackPaths.length}</span>
                        </div>
                        <div class="section-content">
                            ${attackPaths.map((path, i) => `
                                <div class="attack-phase">
                                    <div class="phase-number">${i + 1}</div>
                                    <div class="phase-content">${escapeHtml(path.description || path)}</div>
                                    ${path.probability ? `<div class="phase-probability">${path.probability}%</div>` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            // Credentials Section
            if (credentials.length > 0) {
                html += `
                    <div class="results-section fade-in-up stagger-2" data-type="credentials">
                        <div class="section-header">
                            <div class="section-title">
                                <span class="section-title-icon">&#128274;</span>
                                Compromised Credentials
                            </div>
                            <span class="section-count">${credentials.length}</span>
                        </div>
                        <div class="section-content">
                            ${credentials.slice(0, displayedCredentialCount).map((cred, i) => `
                                <div class="result-item ${getSeverityClass(cred)}" data-source="${escapeHtml(cred.source || 'Unknown')}">
                                    <div class="result-primary">
                                        <div class="result-value">${escapeHtml(cred.email || cred.username || 'N/A')}</div>
                                        <div class="result-badges">
                                            <span class="source-badge">${escapeHtml(cred.source || 'Unknown')}</span>
                                            ${cred.severity ? `<span class="severity-badge ${cred.severity.toLowerCase()}">${cred.severity}</span>` : ''}
                                        </div>
                                    </div>
                                    <div class="result-details">
                                        ${cred.password ? `
                                            <span>
                                                <span class="detail-label">Password:</span>
                                                <span class="password-field">
                                                    <span class="password-value" id="pwd-${i}"></span>
                                                    <button class="password-toggle" onclick="togglePassword(${i}, '${escapeHtml(cred.password)}')">Show</button>
                                                </span>
                                            </span>
                                        ` : ''}
                                        ${cred.domain ? `<span><span class="detail-label">Domain:</span> ${escapeHtml(cred.domain)}</span>` : ''}
                                        ${cred.ip ? `<span><span class="detail-label">IP:</span> ${escapeHtml(cred.ip)}</span>` : ''}
                                    </div>
                                    <div class="result-meta">
                                        <span>${cred.date || cred.breach_date || 'Date unknown'}</span>
                                        <div class="result-actions">
                                            <span class="result-action" onclick="copyToClipboard('${escapeHtml(cred.email || cred.username)}')">Copy</span>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                            ${credentials.length > displayedCredentialCount ? `
                                <button class="expand-btn" onclick="showMoreCredentials()">
                                    Show ${Math.min(10, credentials.length - displayedCredentialCount)} more credentials
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }

            // Infected Machines Section
            if (machines.length > 0) {
                html += `
                    <div class="results-section fade-in-up stagger-3" data-type="machines">
                        <div class="section-header">
                            <div class="section-title">
                                <span class="section-title-icon">&#128187;</span>
                                Infected Machines
                            </div>
                            <span class="section-count">${machines.length}</span>
                        </div>
                        <div class="section-content">
                            ${machines.slice(0, 10).map(machine => `
                                <div class="result-item severity-high" data-source="${escapeHtml(machine.source || 'Infostealer')}">
                                    <div class="result-primary">
                                        <div class="result-value">${escapeHtml(machine.machine_id || machine.hostname || 'Unknown Machine')}</div>
                                        <div class="result-badges">
                                            <span class="source-badge">Infostealer</span>
                                            <span class="severity-badge high">High Risk</span>
                                        </div>
                                    </div>
                                    <div class="result-details">
                                        ${machine.ip ? `<span><span class="detail-label">IP:</span> ${escapeHtml(machine.ip)}</span>` : ''}
                                        ${machine.os ? `<span><span class="detail-label">OS:</span> ${escapeHtml(machine.os)}</span>` : ''}
                                        ${machine.malware ? `<span><span class="detail-label">Malware:</span> ${escapeHtml(machine.malware)}</span>` : ''}
                                    </div>
                                    <div class="result-meta">
                                        <span>${machine.date || 'Date unknown'}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            // Breach History Section
            if (breaches.length > 0) {
                html += `
                    <div class="results-section fade-in-up stagger-4" data-type="breaches">
                        <div class="section-header">
                            <div class="section-title">
                                <span class="section-title-icon">&#128200;</span>
                                Breach History
                            </div>
                            <span class="section-count">${breaches.length}</span>
                        </div>
                        <div class="section-content">
                            ${breaches.slice(0, 10).map(breach => `
                                <div class="result-item" data-source="${escapeHtml(breach.source || 'Breach Database')}">
                                    <div class="result-primary">
                                        <div class="result-value">${escapeHtml(breach.breach_name || breach.name || 'Unknown Breach')}</div>
                                        <div class="result-badges">
                                            <span class="source-badge">${escapeHtml(breach.source || 'HIBP')}</span>
                                        </div>
                                    </div>
                                    <div class="result-details">
                                        ${breach.data_classes ? `<span><span class="detail-label">Exposed:</span> ${escapeHtml(breach.data_classes.join(', '))}</span>` : ''}
                                        ${breach.records ? `<span><span class="detail-label">Records:</span> ${breach.records.toLocaleString()}</span>` : ''}
                                    </div>
                                    <div class="result-meta">
                                        <span>${breach.breach_date || breach.date || 'Date unknown'}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            // Empty results
            if (totalFindings === 0) {
                html += `
                    <div class="empty-state fade-in-up">
                        <div class="empty-state-icon">&#9989;</div>
                        <h3>No Results Found</h3>
                        <p>Good news! No compromised data was found for this query in our databases.</p>
                    </div>
                `;
            }

            resultsDiv.innerHTML = html;
        }

        function getSeverityClass(item) {
            if (item.severity === 'critical' || item.password) return 'severity-critical';
            if (item.severity === 'high') return 'severity-high';
            if (item.severity === 'medium') return 'severity-medium';
            return '';
        }

        function togglePassword(index, password) {
            const element = document.getElementById(`pwd-${index}`);
            const btn = event.target;

            if (element.textContent === '') {
                element.textContent = password;
                btn.textContent = 'Hide';
            } else {
                element.textContent = '';
                btn.textContent = 'Show';
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                // Could show a toast notification here
            });
        }

        function showMoreCredentials() {
            displayedCredentialCount += 10;
            if (currentResults) {
                displayResults(currentResults);
            }
        }

        function escapeHtml(str) {
            if (!str) return '';
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }

        // Filter functions
        function applyFilters() {
            const typeFilter = document.getElementById('filterType').value;
            const sourceFilter = document.getElementById('filterSource').value;
            const dateFilter = document.getElementById('filterDate').value;

            document.querySelectorAll('.results-section').forEach(section => {
                let show = true;

                // Type filter
                if (typeFilter !== 'all') {
                    const sectionType = section.dataset.type;
                    if (sectionType && sectionType !== typeFilter) {
                        show = false;
                    }
                }

                section.style.display = show ? 'block' : 'none';
            });

            // Source filter on individual items
            if (sourceFilter !== 'all') {
                document.querySelectorAll('.result-item').forEach(item => {
                    const itemSource = item.dataset.source;
                    item.style.display = itemSource === sourceFilter ? 'block' : 'none';
                });
            } else {
                document.querySelectorAll('.result-item').forEach(item => {
                    item.style.display = 'block';
                });
            }
        }

        function clearFilters() {
            document.getElementById('filterType').value = 'all';
            document.getElementById('filterSource').value = 'all';
            document.getElementById('filterDate').value = 'all';
            applyFilters();
        }

        // Query History
        function toggleQueryHistory() {
            const dropdown = document.getElementById('query-history-dropdown');
            if (dropdown.classList.contains('show')) {
                dropdown.classList.remove('show');
            } else {
                loadQueryHistory();
                dropdown.classList.add('show');
            }
        }

        function loadQueryHistory() {
            const container = document.getElementById('query-history-list');

            if (queryHistory.length === 0) {
                container.innerHTML = '<p style="color: var(--text-muted); text-align: center; padding: 20px;">No search history yet</p>';
                return;
            }

            const sorted = [...queryHistory].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            container.innerHTML = sorted.slice(0, 15).map(entry => `
                <div class="history-item" onclick="useHistoryQuery('${escapeHtml(entry.query)}')">
                    <span class="history-query">${escapeHtml(entry.query)}</span>
                    <div class="history-meta">
                        <span>${entry.results || 0} results</span>
                        <span>${formatTimeAgo(entry.timestamp)}</span>
                    </div>
                </div>
            `).join('');
        }

        function useHistoryQuery(query) {
            document.getElementById('search-input').value = query;
            document.getElementById('query-history-dropdown').classList.remove('show');
            performSearch();
        }

        function saveQueryToHistory(query, data) {
            const entry = {
                query: query,
                results: data.total_results || 0,
                timestamp: new Date().toISOString()
            };

            queryHistory = queryHistory.filter(h => h.query !== query);
            queryHistory.unshift(entry);
            queryHistory = queryHistory.slice(0, 50);

            localStorage.setItem('ghost_query_history', JSON.stringify(queryHistory));
        }

        function clearQueryHistory() {
            queryHistory = [];
            localStorage.removeItem('ghost_query_history');
            loadQueryHistory();
        }

        function formatTimeAgo(timestamp) {
            const seconds = Math.floor((new Date() - new Date(timestamp)) / 1000);

            if (seconds < 60) return 'just now';
            if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
            return `${Math.floor(seconds / 86400)}d ago`;
        }

        // Export functions
        function exportToJSON() {
            if (!currentResults) return;

            const blob = new Blob([JSON.stringify(currentResults, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ghost-search-${new Date().toISOString().slice(0, 10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function exportToPDF() {
            if (!currentResults || !window.jspdf) return;

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.setFontSize(20);
            doc.text('GHOST Intelligence Report', 20, 20);

            doc.setFontSize(12);
            doc.text(`Query: ${currentResults.query || 'N/A'}`, 20, 35);
            doc.text(`Total Results: ${currentResults.total_results || 0}`, 20, 45);
            doc.text(`Generated: ${new Date().toLocaleString()}`, 20, 55);

            doc.save(`ghost-report-${new Date().toISOString().slice(0, 10)}.pdf`);
        }

        // Email Monitoring
        let monitoredEmails = JSON.parse(localStorage.getItem('ghost_monitored_emails') || '[]');
        let checkFrequency = localStorage.getItem('ghost_check_frequency') || 'weekly';
        let checkHistory = JSON.parse(localStorage.getItem('ghost_check_history') || '[]');

        function addMonitoredEmail() {
            const input = document.getElementById('emailToMonitor');
            const email = input.value.trim();

            if (!email || !email.includes('@')) {
                alert('Please enter a valid email address');
                return;
            }

            if (monitoredEmails.length >= 15) {
                alert('Maximum 15 emails can be monitored');
                return;
            }

            if (!monitoredEmails.find(e => e.email === email)) {
                monitoredEmails.push({ email: email, status: 'pending', lastChecked: null });
                localStorage.setItem('ghost_monitored_emails', JSON.stringify(monitoredEmails));
                renderMonitoredEmails();
            }

            input.value = '';
        }

        function removeMonitoredEmail(email) {
            monitoredEmails = monitoredEmails.filter(e => e.email !== email);
            localStorage.setItem('ghost_monitored_emails', JSON.stringify(monitoredEmails));
            renderMonitoredEmails();
        }

        function renderMonitoredEmails() {
            const container = document.getElementById('monitored-emails-grid');

            if (monitoredEmails.length === 0) {
                container.innerHTML = `
                    <div class="empty-monitoring">
                        <div class="empty-monitoring-icon"></div>
                        <p>No emails monitored yet. Add emails above to start monitoring.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = monitoredEmails.map(item => `
                <div class="monitored-email-card">
                    <div class="email-info">
                        <span class="email-address">${escapeHtml(item.email)}</span>
                        <span class="email-status ${item.status === 'breached' ? 'breached' : item.status === 'safe' ? 'safe' : ''}">${
                            item.status === 'breached' ? ' Breach found' :
                            item.status === 'safe' ? ' No breaches' :
                            'Pending check'
                        }</span>
                    </div>
                    <button class="remove-btn" onclick="removeMonitoredEmail('${escapeHtml(item.email)}')">&times;</button>
                </div>
            `).join('');
        }

        function openBulkEmailModal() {
            document.getElementById('bulkEmailModal').classList.add('show');
        }

        function closeBulkEmailModal() {
            document.getElementById('bulkEmailModal').classList.remove('show');
            document.getElementById('bulkEmailInput').value = '';
        }

        function processBulkEmails() {
            const textarea = document.getElementById('bulkEmailInput');
            const emails = textarea.value.split('\n')
                .map(e => e.trim())
                .filter(e => e && e.includes('@'));

            const remaining = 15 - monitoredEmails.length;
            const toAdd = emails.slice(0, remaining);

            toAdd.forEach(email => {
                if (!monitoredEmails.find(e => e.email === email)) {
                    monitoredEmails.push({ email: email, status: 'pending', lastChecked: null });
                }
            });

            localStorage.setItem('ghost_monitored_emails', JSON.stringify(monitoredEmails));
            renderMonitoredEmails();
            closeBulkEmailModal();

            if (emails.length > remaining) {
                alert(`Added ${toAdd.length} emails. ${emails.length - remaining} emails were skipped due to the 15 email limit.`);
            }
        }

        function updateCheckFrequency() {
            checkFrequency = document.getElementById('checkFrequency').value;
            localStorage.setItem('ghost_check_frequency', checkFrequency);
            document.getElementById('currentFrequency').textContent = checkFrequency.charAt(0).toUpperCase() + checkFrequency.slice(1);
            updateNextCheckTime();
        }

        function updateNextCheckTime() {
            const nextCheckEl = document.getElementById('nextCheckTime');
            const lastCheck = localStorage.getItem('ghost_last_check');

            if (!lastCheck) {
                nextCheckEl.textContent = 'Run first check';
                return;
            }

            const lastDate = new Date(lastCheck);
            let nextDate = new Date(lastDate);

            switch (checkFrequency) {
                case 'daily': nextDate.setDate(nextDate.getDate() + 1); break;
                case 'weekly': nextDate.setDate(nextDate.getDate() + 7); break;
                case 'monthly': nextDate.setMonth(nextDate.getMonth() + 1); break;
            }

            const diff = nextDate - new Date();
            if (diff <= 0) {
                nextCheckEl.textContent = 'Due now';
            } else {
                const days = Math.ceil(diff / (1000 * 60 * 60 * 24));
                nextCheckEl.textContent = `In ${days} day${days > 1 ? 's' : ''}`;
            }
        }

        function renderCheckTimeline() {
            const container = document.getElementById('checkTimeline');

            if (checkHistory.length === 0) {
                container.innerHTML = '<p style="color: var(--text-muted); text-align: center; padding: 20px;">No check history yet. Add emails and run a check to see results.</p>';
                return;
            }

            container.innerHTML = checkHistory.slice(0, 5).map(entry => `
                <div class="timeline-entry">
                    <div class="timeline-date">${new Date(entry.timestamp).toLocaleString()}</div>
                    <div class="timeline-results">
                        <span class="emails-checked">${entry.emailsChecked} emails checked</span>
                        <span class="breaches-found ${entry.breachesFound === 0 ? 'none' : ''}">${entry.breachesFound} ${entry.breachesFound === 1 ? 'exposure' : 'exposures'} found</span>
                    </div>
                    <button onclick="viewCheckDetails('${entry.id}')">View Details</button>
                </div>
            `).join('');
        }

        function viewCheckDetails(checkId) {
            // TODO: Implement detailed view
            alert('Detailed view coming soon');
        }

        function exportMonitoringResults() {
            const data = {
                monitoredEmails: monitoredEmails,
                checkHistory: checkHistory,
                exportDate: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ghost-monitoring-${new Date().toISOString().slice(0, 10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function initializeMonitoring() {
            renderMonitoredEmails();
            renderCheckTimeline();

            // Set frequency select
            const freqSelect = document.getElementById('checkFrequency');
            if (freqSelect) freqSelect.value = checkFrequency;

            document.getElementById('currentFrequency').textContent = checkFrequency.charAt(0).toUpperCase() + checkFrequency.slice(1);

            // Set last check time
            const lastCheck = localStorage.getItem('ghost_last_check');
            if (lastCheck) {
                document.getElementById('lastCheckTime').textContent = formatTimeAgo(lastCheck);
            }

            updateNextCheckTime();
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            const dropdown = document.getElementById('query-history-dropdown');
            const historyBtn = document.querySelector('.search-history-btn');

            if (!dropdown.contains(e.target) && !historyBtn.contains(e.target)) {
                dropdown.classList.remove('show');
            }
        });

        // Initialize
        initializeMonitoring();
    </script>
</body>
</html>
